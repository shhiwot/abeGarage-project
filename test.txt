import React from "react";
import { useState, useEffect } from "react";
import { FaEdit, FaTrash } from "react-icons/fa"; // Icons for edit and delete actions
import serviceService from "../../../../services/service.service"; //to perform API calls related to service data, such as fetching, editing, and deleting employees.
import { useAuth } from "../../../../Contexts/AuthContext";
import { useNavigate } from "react-router-dom"; // Import useNavigate

function Services_management(props) {
  const [services, setServices] = useState([]); //hold an array of service objects fetched from the server
  const [service_name, setService_name] = useState("");
  const [service_description, setService_description] = useState("");
  const [serviceNameError, setNameRequired] = useState("");
  const [serviceDescriptionError, setDescriptionRequired] = useState("");
  const [loading, setLoading] = useState(true); //to indicate whether the data is still being fetched
  const [fetchError, setFetchError] = useState(null); //to hold any error messages that might occur during data fetching or deleting employees.
  const [successMessage, setSuccessMessage] = useState(""); // to display success messages when actions like deleting an employee are successful.
  const { employee } = useAuth(); //to get the current authenticated employee's details, including their token.
  const [serverError, setServerError] = useState("");
  // const { service_id } = useParams(); // Get the employee ID from the URL params
  let loggedInEmployeeToken = "";
  const navigate = useNavigate();
  if (employee && employee.employee_token) {
    loggedInEmployeeToken = employee.employee_token;
  }
  // to fetch services data from the server.
  useEffect(() => {
    const fetchServices = async () => {
      setLoading(true);
      try {
        //Checks if the employee object and employee token exist to ensure that only authenticated users can fetch service data.
        if (employee && employee.employee_token) {
          //Calls the getAllServices method from the serviceService with the employee's token to fetch the service data.
          const result = await serviceService.getAllServices(
            employee.employee_token
          );
          console.log(result);
          //if the result status is "success" updates the service state with the fetched data.
          if (result && Array.isArray(result)) {
            setServices(result);
            console.log(services);
          } else {
            throw new Error("Failed to fetch services");
          }
        }
      } catch (error) {
        //Sets the error message if there is an issue fetching data.
        setFetchError(error.message);
      } finally {
        //Sets the loading state to false once data fetching is complete, whether successful or not.
        setLoading(false);
      }
    };
    fetchServices();
  }, [employee]);

  const handleEdit = (service_id) => {
    //Uses navigate to redirect the user to the edit page for the specified serviceId.
    navigate(`/admin/service/edit/${service_id}`);
  };

  const handleDelete = async (service_id) => {
    // Confirms with the user if they really want to delete the service.
    if (window.confirm("Are you sure you want to delete this service?")) {
      try {
        if (employee && employee.employee_token) {
          //Calls the deleteService method from serviceService to delete the service using the provided token and serviceId.
          await serviceService.deleteService(
            employee.employee_token,
            service_id
          );
          // Updates the Service state to remove the deleted Service.
          setServices(services.filter((ser) => ser.id !== service_id));
          // Set the success message
          setSuccessMessage("Service has been successfully deleted.");
          // Clear the success message after 3 seconds
          setTimeout(() => {
            setSuccessMessage("");
          }, 3000); // Adjust the duration as needed
        }
      } catch (error) {
        setFetchError(`Failed to delete service: ${error.message}`);
      }
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    let valid = true;

    if (!service_name) {
      setNameRequired("Service name is required");
      valid = false;
    } else {
      setNameRequired("");
    }
    if (!service_description) {
      setDescriptionRequired("Service description is required");
      valid = false;
    } else {
      setDescriptionRequired("");
    }

    if (!valid) {
      return;
    }
    const formData = {
      service_name,
      service_description,
    };

    try {
      const response = await serviceService.createService(
        formData,
        loggedInEmployeeToken
      );
      // Check if the response is a JSON object
      const data = await response;
      if (data.error) {
        setServerError(data.error);
      } else {
        setSuccessMessage("Service added successfully!");
        setServerError("");
        setTimeout(() => {
          window.location.href = "/admin/services";
        }, 2000);
      }
    } catch (error) {
      const resMessage =
        (error.response &&
          error.response.data &&
          error.response.data.message) ||
        error.message ||
        error.toString();
      setServerError(resMessage);
    }
  };
  // Render loading state
  if (loading) {
    return <p>Loading...</p>;
  }
  console.log(services);
  return (
    <>
      {/* Header */}
      <header className="header">
        <h4 className="mr-2">Services we provide</h4>
        <span className="header-line" />
      </header>
      <p className="header-description">
        Bring to the table win-win survival strategies to ensure proactive
        domination. At the end of the day, going forward, a new normal that has
        evolved from generation X is on the runway heading towards a streamlined
        cloud solution.
      </p>
      {successMessage && (
        <div
          className="success-message"
          style={{ color: "green", fontSize: "18px" }}
        >
          {successMessage}
        </div>
      )}
      {/* Render error message if present */}
      {fetchError && (
        <div
          className="error-message"
          style={{ color: "red", marginBottom: "20px" }}
        >
          Error: {fetchError}
        </div>
      )}
      {/* Services List */}
      <div className="services-list">
        {services &&
          services.map((service, index) => (
            <div key={index} className="service-item">
              <h5>{service?.service_name || "No name available"}</h5>
              <div className="service-actions">
                <p>
                  {service?.service_description || "No description available"}
                </p>
                <div className="icon ml-4 ">
                  <button onClick={() => handleEdit(service.id)}>
                    <FaEdit
                      className="icon edit-icon "
                      size={14}
                      style={{ color: "red" }}
                    />
                  </button>
                  <button onClick={() => handleDelete(service.id)}>
                    <FaTrash className="icon delete-icon " size={14} />
                  </button>
                </div>
              </div>
            </div>
          ))}
      </div>
      {/* Add New Service Form */}
      <div className="mt-4">
        <div className="header">
          <h5 className="mr-2" style={{ fontWeight: "bold" }}>
            Add a new service
          </h5>
          <span className="header2-line" />
        </div>
        {serverError && (
          <div className="validation-error" role="alert">
            {serverError}
          </div>
        )}
        <form className="add-service-form" onSubmit={handleSubmit}>
          <input
            type="text"
            name="service_name"
            value={service_name}
            onChange={(event) => setService_name(event.target.value)}
            placeholder="Service_name"
          />
          {serviceNameError && (
            <div className="validation-error" role="alert">
              {serviceNameError}
            </div>
          )}
          <textarea
            type="text"
            name="service_description"
            value={service_description}
            onChange={(event) => setService_description(event.target.value)}
            placeholder="Service_description"
          ></textarea>
          {serviceDescriptionError && (
            <div className="validation-error" role="alert">
              {serviceDescriptionError}
            </div>
          )}
          <button type="submit" data-loading-text="Please wait...">
            ADD SERVICE
          </button>
        </form>
      </div>
    </>
  );
}

export default Services_management;
const api_url = import.meta.env.VITE_API_URL;

// A function to send post request to create a new employee
const createService = async (formData, loggedInEmployeeToken) => {
  console.log(formData);
  const requestOptions = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-access-token": loggedInEmployeeToken,
    },
    body: JSON.stringify(formData),
  };
  console.log("Creating service with", requestOptions);

  try {
    //Call this function when you want to add a new service to the system. It takes formData (service details) and the token of the logged-in user.
    const response = await fetch(`${api_url}/api/service`, requestOptions);
    if (!response.ok) {
      const errorText = await response.text();
      console.error(
        `Failed to create service. Status: ${response.status}, Details: ${errorText}`
      );
      throw new Error(`Failed to create service: ${errorText}`);
    }
    return response.json();
  } catch (error) {
    console.error("Error creating service:", error);
    throw error;
  }
};

// A function to send get request to get a list of all employees from the server.
const getAllServices = async (token) => {
  const requestOptions = {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
      "x-access-token": token,
    },
  };

  try {
    const response = await fetch(`${api_url}/api/services`, requestOptions);
    // Check if the response status is OK
    console.log(response);
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    // Parse the JSON data from the response
    const data = await response.json();
    console.log(data);
    // Check the status of the returned data
    if (data && Array.isArray(data) && data.length > 0) {
      console.log("Data fetched successfully:", data);
      return data; // Return the data to be used by the calling code
    } else {
      console.error("No data returned or data is not in expected format.");
      throw new Error(
        `No service data available. Please add a new service.`
      );
    }
  } catch (error) {
    console.error("Error fetching services:", error);
    throw error; // Re-throw the error to be handled by the caller
  }
};

const getServiceById = async (token, id) => {
  console.log("Fetching service ID:", id);
  const requestOptions = {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
      "x-access-token": token,
    },
  };

  try {
    const response = await fetch(
      `${api_url}/api/service/${id}`,
      requestOptions
    );

    console.log("Response:", response);

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(
        `HTTP error! Status: ${response.status}, Details: ${errorText}`
      );
    }

    const data = await response.json();

    console.log("Data:", data);

    // Ensure `data` contains `data` field and it is an array with at least one item
    if (typeof data !== "object" || Object.keys(data).length === 0) {
      throw new Error(
        `Failed to fetch service: ${data.message || "Unknown error"}`
      );
    }
    // Return the first item of the array
    return data;
  } catch (error) {
    console.error("Error fetching service:", error);
    throw error;
  }
};
// Function to update employee data
const updateService = async (token, formData, id) => {
  const requestOptions = {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "x-access-token": token,
    },
    body: JSON.stringify(formData),
  };
  console.log("FormData being sent:", formData);
  try {
    const response = await fetch(
      `${api_url}/api/service/${id}`,
      requestOptions
    );
    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(
        `HTTP error! Status: ${response.status}, Details: ${errorText}`
      );
    }
    if (response.status === 200) {
      return response; // Return the data if the update was successful
    } else {
      throw new Error(
        `Failed to update service: ${data.message || "Unknown error"}`
      );
    }
  } catch (error) {
    console.error("Error updating service:", error);
    throw error;
  }
};

// A function to send delete request to delete an employee
const deleteService = async (token, id) => {
  const requestOptions = {
    method: "DELETE",
    headers: {
      "Content-Type": "application/json",
      "x-access-token": token,
    },
  };

  try {
    const response = await fetch(
      `${api_url}/api/service/${id}`,
      requestOptions
    );
    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(
        `HTTP error! Status: ${response.status}, Details: ${errorText}`
      );
    }

    if (response.status === 200) {
      console.log(response);
      return response; // Return the data if the delete was successful
    } else {
      throw new Error(
        `Failed to delete service: ${data.message || "Unknown error"}`
      );
    }
  } catch (error) {
    console.error("Error deleting service:", error);
    throw error;
  }
};

// Export all the functions
const serviceService = {
  createService,
  getAllServices,
  getServiceById,
  updateService,
  deleteService,
};
export default serviceService;







the above frontend code fetch the service list from the server database system whereas the following frontend codes as not fetching the service list from backend server database ."import React, { useState } from "react";
import image4 from "../../assets/images/Service_miniBanner.png";
import "./home.css";
function ServiceDetail() {
  const [selectedService, setSelectedService] = useState(null);

  const handleReadMoreClick = (service) => {
    setSelectedService(service);
  };

  const renderServiceBlock = (title, iconClass, service) => (
    <div className="col-lg-4 service-block-one">
      <div className="inner-box hvr-float-shadow">
        <h5>Service and Repairs</h5>
        <h2>{title}</h2>
        <a
          href="#"
          className="read-more"
          onClick={() => handleReadMoreClick(service)}
          aria-label={`Read more about ${title}`}
        >
          read more +
        </a>
        <div className="icon">
          <span className={iconClass}></span>
        </div>
      </div>
    </div>
  );

  // Check if a service is selected
  if (selectedService) {
    return (
      <div className="services-section">
        <div className="service-block-one auto-container">
          <div className="inner-box hvr-float-shadow">
            <h2>{selectedService.title}</h2>
            <p>{selectedService.description}</p>
            <h4>Service List</h4>
            {selectedService.servicesList && (
              <ul className="service-list">
                {selectedService.servicesList.map((item, index) => (
                  <li key={index}>
                    <strong>{item.name}</strong>:{" "}
                    <span>{item.description}</span>
                  </li>
                ))}
              </ul>
            )}
            <div className="mt-3">
              <a
                href="#"
                onClick={() => setSelectedService(null)}
                style={{ fontSize: "17px", fontWeight: "600" }}
              >
                Back to Services
              </a>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="homeWrapper">
      <section className="video2-section">
        <div data-parallax='{"y": 50}' className="services-bg1"></div>
      </section>

      <section className="services-section">
        <div className="auto-container">
          <div className="sec-title style-two">
            <h2>Our Services</h2>
            <div className="text">
              Bring to the table win-win survival strategies to ensure proactive
              domination. At the end of the day, going forward, a new normal
              that has evolved from generation X is on the runway heading
              towards a streamlined cloud solution.{" "}
            </div>
          </div>
          <div className="row">
            {renderServiceBlock("Performance Upgrade", "flaticon-power", {
              title: "Performance Upgrade",
              description:
                "Unlock your vehicle’s full potential with our advanced performance upgrade services. From ECU remapping to turbocharger installations, our experts enhance power, torque, and fuel efficiency for a superior driving experience. Learn more about our range of upgrades tailored to your needs, and schedule a consultation to elevate your vehicle's performance today!",
              servicesList: [
                {
                  name: "The Ignition System",
                  description:
                    "A car’s ignition system includes its battery, starter, and the ignition itself.",
                },
                {
                  name: "Turbocharger Installation",
                  description:
                    "Adding a turbocharger to increase engine power and acceleration.",
                },
                {
                  name: "Cold Air Intake Installation",
                  description:
                    "Upgrading the air intake system to enhance engine performance and fuel efficiency.",
                },
                {
                  name: "High-Performance Exhaust System",
                  description:
                    "Installing a performance exhaust system to improve engine output and sound.",
                },
              ],
            })}

            {renderServiceBlock("Transmission Services", "flaticon-gearbox", {
              title: "Transmission Services",
              description:
                "Ensure smooth and efficient gear shifts with our comprehensive transmission services. Our skilled technicians specialize in transmission fluid changes, clutch replacements, and full transmission rebuilds to maintain your vehicle’s optimal performance.Learn more about the importance of regular transmission maintenance, explore our reliable services, and book an appointment for a smoother drive.",
              servicesList: [
                {
                  name: "Fuel Cap tightening",
                  description:
                    "Loose fuel caps are actually a main reason why the “check engine” light in a car comes on. (Although this is not directly related to transmission services, it is often considered a part of overall vehicle maintenance.",
                },
                {
                  name: "Transmission Fluid Change:",
                  description:
                    "Replacing old transmission fluid to ensure smooth gear shifts and prevent overheating.",
                },
                {
                  name: "Clutch Replacement",
                  description:
                    "Replacing worn-out clutch components to restore proper vehicle control and performance.",
                },
                {
                  name: "Transmission Repair",
                  description:
                    "Diagnosing and repairing issues with the transmission to restore proper function.",
                },
              ],
            })}
            {renderServiceBlock(
              "Break Repair & Service",
              "flaticon-brake-disc",
              {
                title: "Break Repair & Service",
                description:
                  "We all know why brake work is important, especially because one quarter of all car accidents are caused by a failure to stop.Discover why we are the trusted choice for comprehensive brake repair and service solutions. Our certified technicians specialize in brake pad replacements, rotor repairs, and complete brake system diagnostics to ensure your vehicle's safety and performance. Learn more about the importance of regular brake maintenance, explore our reliable and affordable brake solutions, and schedule an appointment today to keep your car safe on the road.",
                servicesList: [
                  {
                    name: "Brake Pad Replacement:",
                    description:
                      "Replacing worn brake pads to ensure effective braking performance.",
                  },
                  {
                    name: "Rotor Resurfacing",
                    description:
                      "Smoothing out the brake rotors to restore proper braking function and reduce noise.",
                  },
                  {
                    name: "Brake Fluid Flush",
                    description:
                      "Replacing old brake fluid to maintain optimal brake system performance.",
                  },
                  {
                    name: "Brake Caliper Inspection & Repair",
                    description:
                      "Checking and repairing brake calipers to ensure they are functioning properly and applying even pressure to the brake pads.",
                  },
                ],
              }
            )}
            {renderServiceBlock(
              "Engine Service & Repair",
              "flaticon-car-engine",
              {
                title: "Engine Service & Repair",
                description:
                  "Keep your engine running smoothly with our expert engine service and repair solutions. From oil changes and spark plug replacements to full engine diagnostics, our experienced team ensures your vehicle performs at its best. Learn more about our comprehensive engine care services, the benefits of regular maintenance, and book a service to maintain your engine’s health and efficiency.",
                servicesList: [
                  {
                    name: "Oil Change",
                    description:
                      "Every 5,000 kilometers or so, you need to change the oil in your car to keep your engine in the best possible shape",
                  },
                  {
                    name: "Spark Plug Replacement",
                    description:
                      "Spark plugs are a small part that can cause huge problems. Their job is to ignite the fuel in your engine, helping it start.",
                  },
                  {
                    name: "Oxygen Sensor Replacement",
                    description:
                      "Oxygen sensors measure the concentration of oxygen in the exhaust gases in order to optimize engine performance and emissions.",
                  },
                  {
                    name: "Engine Diagnostics",
                    description:
                      "Conducting comprehensive diagnostics to identify and address engine issues and maintain peak performance.",
                  },
                  {
                    name: "Timing Belt Replacement",
                    description:
                      "Replacing the timing belt to prevent engine damage and ensure proper engine timing",
                  },
                ],
              }
            )}
            {renderServiceBlock("Tyre & Wheels", "flaticon-tire", {
              title: "Tyre & Wheels",
              description:
                "Maximize safety and driving comfort with our tyre and wheel services. Whether you need tire repairs, replacements, or wheel alignments, our specialists ensure optimal road grip and fuel efficiency.Learn more about our full range of tyre and wheel services, the importance of regular checks, and book an appointment to keep your vehicle rolling smoothly.",
              servicesList: [
                {
                  name: "Tire repairs and changes",
                  description:
                    "Without good, inflated tires, you lose speed, control, and fuel efficiency. Hence the need to get them patched if there’s a leak (for example, if you run over a nail), or replaced if they’re too worn",
                },
                {
                  name: "Tyre Replacement",
                  description:
                    "Installing new tyres to ensure optimal performance and safety.",
                },
                {
                  name: "Wheel Alignment",
                  description:
                    "Adjusting the angles of your wheels to ensure proper handling and reduce tyre wear.",
                },
                {
                  name: "Wheel Balancing",
                  description:
                    "Balancing wheels to eliminate vibrations and ensure a smooth ride.",
                },
              ],
            })}
            {renderServiceBlock("Denting & Painting", "flaticon-spray-gun", {
              title: "Denting & Painting",
              description:
                "Restore your vehicle’s original beauty with our professional denting and painting services. From minor scratch repairs to complete paint jobs, our experts use high-quality materials to give your car a flawless finish. Learn more about our paint restoration and dent repair options, see our competitive pricing, and schedule a visit to bring back your car's showroom shine.",
              servicesList: [
                {
                  name: "Dent Removal",
                  description:
                    "Repairing minor dents and dings without affecting the original paint.",
                },
                {
                  name: "Scratch Repair",
                  description:
                    "Fixing surface scratches and restoring the paint's original finish.",
                },
                {
                  name: "Full Paint Job",
                  description:
                    "Repainting the entire vehicle for a fresh, new look or to match the original color.",
                },
                {
                  name: "Touch-Up Painting",
                  description:
                    "Applying paint to small areas to cover imperfections and maintain the vehicle's appearance.",
                },
              ],
            })}
          </div>
        </div>
      </section>
      <section className="why-choose-us">
        <div className="auto-container">
          <div className="row">
            <div className="col-lg-6">
              <div className="sec-title style-two">
                <h2>Why Choose Us</h2>
                <div className="text">
                  Bring to the table win-win survival strategies to ensure
                  proactive domination. At the end of the day, going forward, a
                  new normal that has evolved from generation heading towards.
                </div>
              </div>
              <div className="icon-box">
                <div className="icon">
                  <span className="flaticon-mechanic"></span>
                </div>
                <h4>Certified Expert Mechanics</h4>
              </div>
              <div className="icon-box">
                <div className="icon">
                  <span className="flaticon-wrench"></span>
                </div>
                <h4>Fast And Quality Service</h4>
              </div>
              <div className="icon-box">
                <div className="icon">
                  <span className="flaticon-price-tag-1"></span>
                </div>
                <h4>Best Prices in Town</h4>
              </div>
              <div className="icon-box">
                <div className="icon">
                  <span className="flaticon-trophy"></span>
                </div>
                <h4>Awarded Workshop</h4>
              </div>
            </div>
            <div className="col-lg-6">
              <div className="sec-title style-two">
                <h2>Addtional Services</h2>
              </div>
              <div className="row">
                <div className="col-md-5">
                  <div className="image4">
                    <img src={image4} alt="" />
                  </div>
                </div>
                <div className="col-md-7">
                  <ul className="list">
                    <li>General Auto Repair & Maintenance</li>
                    <li>Transmission Repair & Replacement</li>
                    <li>Tire Repair and Replacement</li>
                    <li>State Emissions Inspection</li>
                    <li>Break Job / Break Services</li>
                    <li>Electrical Diagnostics</li>
                    <li>Fuel System Repairs</li>
                    <li>Starting and Charging Repair</li>
                    <li>Steering and Suspension Work</li>
                    <li>Emission Repair Facility</li>
                    <li>Wheel Alignment</li>
                    <li>Computer Diagaonstic Testing</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section className="video3-section another-section">
        <div data-parallax='{"y": 50}' className="services-bg2"></div>
      </section>

      <section className="cta-section">
        <div className="auto-container">
          <div className="wrapper-box">
            <div className="left-column">
              <h3>Schedule Your Appointment Today</h3>
              <div className="text">
                Your Automotive Repair & Maintenance Service Specialist
              </div>
            </div>
            <div className="right-column">
              <div className="phone">1800.456.7890</div>
              <div className="btn">
                <a href="#" className="theme-btn btn-style-one">
                  <span>Appointment</span>
                  <i className="flaticon-right"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  );
}

export default ServiceDetail;
"so i want to update the  serviceDetail.jsx frontend react component code to fetch from the backend server database ?